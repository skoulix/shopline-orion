{{#comment}} Testimonials Section {{/comment}}
<div class="testimonials-section py-16 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {{#if section.settings.title}}
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-4">{{section.settings.title}}</h2>
        {{#if section.settings.subtitle}}
          <p class="text-lg text-gray-600 max-w-2xl mx-auto">{{section.settings.subtitle}}</p>
        {{/if}}
      </div>
    {{/if}}

    {{#if section.blocks.size > 0}}
      <div class="testimonials-container">
        {{#if section.blocks.size == 1}}
          <!-- Single testimonial - centered -->
          <div class="max-w-4xl mx-auto">
            {{#each section.blocks}}
              <div class="testimonial-item text-center">
                {{#if settings.rating}}
                  <div class="flex justify-center mb-6">
                    {{#repeat settings.rating}}
                      <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                    {{/repeat}}
                  </div>
                {{/if}}
                
                <blockquote class="text-2xl font-medium text-gray-900 mb-8">
                  "{{settings.quote}}"
                </blockquote>
                
                <div class="flex items-center justify-center">
                  {{#if settings.image}}
                    <img 
                      src="{{image settings.image width=64 height=64}}" 
                      alt="{{settings.author}}"
                      class="w-16 h-16 rounded-full object-cover mr-4"
                    >
                  {{/if}}
                  <div class="text-left">
                    <div class="font-semibold text-gray-900">{{settings.author}}</div>
                    {{#if settings.position}}
                      <div class="text-sm text-gray-600">{{settings.position}}</div>
                    {{/if}}
                  </div>
                </div>
              </div>
            {{/each}}
          </div>
        {{else}}
          <!-- Multiple testimonials - grid or slider -->
          {{#if section.settings.layout == "slider"}}
            <div class="testimonials-slider relative">
              <div class="overflow-hidden">
                <div class="flex transition-transform duration-300 ease-in-out" id="testimonials-track">
                  {{#each section.blocks}}
                    <div class="testimonial-slide flex-shrink-0 w-full">
                      <div class="max-w-4xl mx-auto text-center">
                        {{#if settings.rating}}
                          <div class="flex justify-center mb-6">
                            {{#repeat settings.rating}}
                              <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                              </svg>
                            {{/repeat}}
                          </div>
                        {{/if}}
                        
                        <blockquote class="text-2xl font-medium text-gray-900 mb-8">
                          "{{settings.quote}}"
                        </blockquote>
                        
                        <div class="flex items-center justify-center">
                          {{#if settings.image}}
                            <img 
                              src="{{image settings.image width=64 height=64}}" 
                              alt="{{settings.author}}"
                              class="w-16 h-16 rounded-full object-cover mr-4"
                            >
                          {{/if}}
                          <div class="text-left">
                            <div class="font-semibold text-gray-900">{{settings.author}}</div>
                            {{#if settings.position}}
                              <div class="text-sm text-gray-600">{{settings.position}}</div>
                            {{/if}}
                          </div>
                        </div>
                      </div>
                    </div>
                  {{/each}}
                </div>
              </div>
              
              <!-- Navigation -->
              <button 
                class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-shadow"
                onclick="changeTestimonial(-1)"
              >
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
              </button>
              
              <button 
                class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-white rounded-full p-3 shadow-lg hover:shadow-xl transition-shadow"
                onclick="changeTestimonial(1)"
              >
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </button>
              
              <!-- Dots -->
              <div class="flex justify-center mt-8 space-x-2">
                {{#each section.blocks}}
                  <button 
                    class="w-3 h-3 rounded-full transition-colors {{#if @first}}bg-red-600{{else}}bg-gray-300{{/if}}"
                    onclick="goToTestimonial({{@index}})"
                    data-testimonial-dot="{{@index}}"
                  ></button>
                {{/each}}
              </div>
            </div>
          {{else}}
            <!-- Grid layout -->
            <div class="grid grid-cols-1 {{#if section.blocks.size >= 3}}md:grid-cols-3{{else if section.blocks.size == 2}}md:grid-cols-2{{/if}} gap-8">
              {{#each section.blocks}}
                <div class="testimonial-card bg-white p-8 rounded-lg shadow-md text-center">
                  {{#if settings.rating}}
                    <div class="flex justify-center mb-4">
                      {{#repeat settings.rating}}
                        <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                      {{/repeat}}
                    </div>
                  {{/if}}
                  
                  <blockquote class="text-lg text-gray-900 mb-6">
                    "{{settings.quote}}"
                  </blockquote>
                  
                  <div class="flex items-center justify-center">
                    {{#if settings.image}}
                      <img 
                        src="{{image settings.image width=48 height=48}}" 
                        alt="{{settings.author}}"
                        class="w-12 h-12 rounded-full object-cover mr-3"
                      >
                    {{/if}}
                    <div class="text-left">
                      <div class="font-semibold text-gray-900 text-sm">{{settings.author}}</div>
                      {{#if settings.position}}
                        <div class="text-xs text-gray-600">{{settings.position}}</div>
                      {{/if}}
                    </div>
                  </div>
                </div>
              {{/each}}
            </div>
          {{/if}}
        {{/if}}
      </div>
    {{else}}
      <!-- Empty State -->
      <div class="text-center py-12">
        <div class="mb-4">
          <svg class="mx-auto w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">Add testimonials</h3>
        <p class="text-gray-500">Share customer reviews and feedback</p>
      </div>
    {{/if}}
  </div>
</div>

{{#if section.settings.layout == "slider" and section.blocks.size > 1}}
<script>
  let currentTestimonial = 0;
  const totalTestimonials = {{section.blocks.size}};
  let autoplayInterval;
  
  function showTestimonial(index) {
    const track = document.getElementById('testimonials-track');
    const dots = document.querySelectorAll('[data-testimonial-dot]');
    
    // Update track position
    track.style.transform = `translateX(-${index * 100}%)`;
    
    // Update dots
    dots.forEach((dot, i) => {
      if (i === index) {
        dot.classList.remove('bg-gray-300');
        dot.classList.add('bg-red-600');
      } else {
        dot.classList.remove('bg-red-600');
        dot.classList.add('bg-gray-300');
      }
    });
    
    currentTestimonial = index;
  }
  
  function changeTestimonial(direction) {
    let newIndex = currentTestimonial + direction;
    
    if (newIndex >= totalTestimonials) {
      newIndex = 0;
    } else if (newIndex < 0) {
      newIndex = totalTestimonials - 1;
    }
    
    showTestimonial(newIndex);
  }
  
  function goToTestimonial(index) {
    showTestimonial(index);
  }
  
  // Auto-play functionality
  function startAutoplay() {
    {{#if section.settings.autoplay}}
      autoplayInterval = setInterval(() => {
        changeTestimonial(1);
      }, {{section.settings.autoplay_speed | default: 5000}});
    {{/if}}
  }
  
  function stopAutoplay() {
    if (autoplayInterval) {
      clearInterval(autoplayInterval);
    }
  }
  
  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    if (totalTestimonials > 1) {
      startAutoplay();
      
      // Pause autoplay on hover
      const slider = document.querySelector('.testimonials-slider');
      slider.addEventListener('mouseenter', stopAutoplay);
      slider.addEventListener('mouseleave', startAutoplay);
    }
  });
</script>
{{/if}}

{{#schema}}
{
  "name": "Testimonials",
  "class": "section",
  "max_blocks": 10,
  "settings": [
    {
      "type": "group_header",
      "label": "Section settings"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "What Our Customers Say"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subheading"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "slider",
          "label": "Slider"
        }
      ],
      "default": "grid"
    },
    {
      "type": "switch",
      "id": "autoplay",
      "label": "Auto-rotate testimonials (slider only)",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Auto-rotate speed",
      "min": 3000,
      "max": 10000,
      "step": 1000,
      "unit": "ms",
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Quote",
          "placeholder": "Amazing product! Highly recommend..."
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author name",
          "placeholder": "John Smith"
        },
        {
          "type": "text",
          "id": "position",
          "label": "Author position/title",
          "placeholder": "CEO, Company Name"
        },
        {
          "type": "image",
          "id": "image",
          "label": "Author photo"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Star rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        }
      ]
    }
  ]
}
{{/schema}}