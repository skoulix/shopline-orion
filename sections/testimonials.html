<div class="testimonials-section py-16 {{section.settings.color_scheme}}">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {{#if section.settings.heading}}
      <div class="text-center mb-16">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">{{section.settings.heading}}</h2>
        {{#if section.settings.subheading}}
          <p class="text-xl text-gray-600 max-w-3xl mx-auto">{{section.settings.subheading}}</p>
        {{/if}}
      </div>
    {{/if}}

    {{#if section.blocks.size > 0}}
      <testimonials-carousel
        data-auto-rotate="{{section.settings.auto_rotate}}"
        data-change-slides-speed="{{section.settings.change_slides_speed}}"
        data-show-navigation="{{section.settings.show_navigation}}"
        data-show-pagination="{{section.settings.show_pagination}}"
        class="testimonials-carousel"
      >
        <div class="testimonials-wrapper overflow-hidden">
          <div class="testimonials-track flex transition-transform duration-500 ease-in-out">
            {{#each section.blocks}}
              <div 
                class="testimonial-slide flex-shrink-0 w-full {{#if ../section.settings.layout == 'grid'}}md:w-1/2 lg:w-1/3{{/if}} px-4"
                {{{shopline_attributes}}}
              >
                <div class="testimonial-card bg-white rounded-lg shadow-sm p-8 h-full flex flex-col {{#if ../section.settings.text_alignment == 'center'}}text-center{{else if ../section.settings.text_alignment == 'right'}}text-right{{else}}text-left{{/if}}">
                  {{#if ../section.settings.show_stars}}
                    <div class="flex {{#if ../section.settings.text_alignment == 'center'}}justify-center{{else if ../section.settings.text_alignment == 'right'}}justify-end{{else}}justify-start{{/if}} mb-4">
                      <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                      <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                      <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                      <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                      <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                      </svg>
                    </div>
                  {{/if}}

                  {{#if quote}}
                    <blockquote class="text-lg text-gray-700 mb-6 flex-grow">
                      "{{quote}}"
                    </blockquote>
                  {{/if}}

                  <div class="testimonial-author mt-auto">
                    {{#if author_image}}
                      <div class="flex items-center {{#if ../section.settings.text_alignment == 'center'}}justify-center{{else if ../section.settings.text_alignment == 'right'}}justify-end{{else}}justify-start{{/if}} gap-4">
                        <img 
                          src="{{image_url author_image width=80}}" 
                          alt="{{author_name}}"
                          class="w-12 h-12 rounded-full object-cover"
                          loading="lazy"
                        >
                        <div>
                          {{#if author_name}}
                            <cite class="font-semibold text-gray-900 not-italic">{{author_name}}</cite>
                          {{/if}}
                          {{#if author_title}}
                            <p class="text-sm text-gray-600">{{author_title}}</p>
                          {{/if}}
                        </div>
                      </div>
                    {{else}}
                      <div>
                        {{#if author_name}}
                          <cite class="font-semibold text-gray-900 not-italic block">{{author_name}}</cite>
                        {{/if}}
                        {{#if author_title}}
                          <p class="text-sm text-gray-600">{{author_title}}</p>
                        {{/if}}
                      </div>
                    {{/if}}
                  </div>
                </div>
              </div>
            {{/each}}
          </div>
        </div>

        {{#if section.settings.show_navigation}}
          {{#if section.blocks.size > 1}}
            <button 
              class="testimonials-prev absolute left-4 top-1/2 transform -translate-y-1/2 bg-white shadow-lg hover:shadow-xl text-gray-700 rounded-full p-3 transition-all z-10"
              aria-label="Previous testimonial"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            
            <button 
              class="testimonials-next absolute right-4 top-1/2 transform -translate-y-1/2 bg-white shadow-lg hover:shadow-xl text-gray-700 rounded-full p-3 transition-all z-10"
              aria-label="Next testimonial"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          {{/if}}
        {{/if}}

        {{#if section.settings.show_pagination}}
          {{#if section.blocks.size > 1}}
            <div class="flex justify-center mt-8 space-x-2">
              {{#each section.blocks}}
                <button 
                  class="testimonial-indicator w-3 h-3 rounded-full bg-gray-300 transition-colors {{#if @first}}bg-red-600{{/if}}"
                  data-slide-index="{{@index}}"
                  aria-label="Go to testimonial {{@index}}"
                ></button>
              {{/each}}
            </div>
          {{/if}}
        {{/if}}
      </testimonials-carousel>
    {{else}}
      <div class="text-center py-12">
        <h3 class="text-xl font-semibold text-gray-900 mb-2">Add testimonials</h3>
        <p class="text-gray-600">Share customer reviews and build trust with your audience.</p>
      </div>
    {{/if}}
  </div>
</div>

{{#schema}}
{
  "name": "t:sections.testimonials.name",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "default": "What our customers say",
      "label": "t:sections.testimonials.settings.heading.label"
    },
    {
      "type": "text",
      "id": "subheading",
      "default": "Don't just take our word for it",
      "label": "t:sections.testimonials.settings.subheading.label"
    },
    {
      "type": "select",
      "id": "layout",
      "options": [
        {
          "value": "slider",
          "label": "t:sections.testimonials.settings.layout.options__1.label"
        },
        {
          "value": "grid",
          "label": "t:sections.testimonials.settings.layout.options__2.label"
        }
      ],
      "default": "slider",
      "label": "t:sections.testimonials.settings.layout.label"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "options": [
        {
          "value": "left",
          "label": "t:sections.testimonials.settings.text_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.testimonials.settings.text_alignment.options__2.label"
        },
        {
          "value": "right",
          "label": "t:sections.testimonials.settings.text_alignment.options__3.label"
        }
      ],
      "default": "center",
      "label": "t:sections.testimonials.settings.text_alignment.label"
    },
    {
      "type": "switch",
      "id": "show_stars",
      "default": true,
      "label": "t:sections.testimonials.settings.show_stars.label"
    },
    {
      "type": "switch",
      "id": "show_navigation",
      "default": true,
      "label": "t:sections.testimonials.settings.show_navigation.label"
    },
    {
      "type": "switch",
      "id": "show_pagination",
      "default": true,
      "label": "t:sections.testimonials.settings.show_pagination.label"
    },
    {
      "type": "switch",
      "id": "auto_rotate",
      "default": false,
      "label": "t:sections.testimonials.settings.auto_rotate.label"
    },
    {
      "type": "range",
      "id": "change_slides_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "t:sections.testimonials.settings.change_slides_speed.label",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "t:sections.testimonials.blocks.testimonial.name",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "default": "Add customer reviews and testimonials to showcase your store's happy customers.",
          "label": "t:sections.testimonials.blocks.testimonial.settings.quote.label"
        },
        {
          "type": "text",
          "id": "author_name",
          "default": "Author's name",
          "label": "t:sections.testimonials.blocks.testimonial.settings.author_name.label"
        },
        {
          "type": "text",
          "id": "author_title",
          "default": "Author's title",
          "label": "t:sections.testimonials.blocks.testimonial.settings.author_title.label"
        },
        {
          "type": "image_picker",
          "id": "author_image",
          "label": "t:sections.testimonials.blocks.testimonial.settings.author_image.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.testimonials.presets.testimonials.name",
      "blocks": [
        {
          "type": "testimonial"
        },
        {
          "type": "testimonial"
        },
        {
          "type": "testimonial"
        }
      ]
    }
  ]
}
{{/schema}}