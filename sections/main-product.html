<div class="product-page py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Breadcrumbs -->
    {{#if section.settings.show_breadcrumb}}
      <nav class="mb-6" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-sm text-gray-600">
          <li><a href="/" class="hover:text-red-600">Home</a></li>
          <li><span class="mx-2">/</span></li>
          {{#if product.collections.first}}
            <li><a href="{{product.collections.first.url}}" class="hover:text-red-600">{{product.collections.first.title}}</a></li>
            <li><span class="mx-2">/</span></li>
          {{/if}}
          <li class="text-gray-900 font-medium">{{product.title}}</li>
        </ol>
      </nav>
    {{/if}}

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
      <!-- Product Images with Vue Gallery -->
      <div class="product-images">
        <product-gallery
          :images='{{json product.images}}'
          product-title="{{product.title}}"
          :image-transform-width="1200"
          :thumbnail-width="120"
        ></product-gallery>
      </div>

      <!-- Product Info with Vue Component -->
      <div class="product-info-wrapper">
        {{assign "product_json" (json product)}}
        <product-info
          :product='{{product_json}}'
          :show-buy-now="{{section.settings.show_buy_now}}"
          @variant-change="handleVariantChange"
        ></product-info>
      </div>
    </div>

    <!-- Product Tabs -->
    {{#if section.blocks}}
      <div class="mt-12 border-t pt-12">
        <div class="tabs">
          <!-- Tab Headers -->
          <div class="flex border-b">
            {{#each section.blocks}}
              {{#if type == "tab"}}
                <button 
                  class="tab-header px-4 py-2 font-medium text-gray-600 border-b-2 border-transparent hover:text-red-600 {{#if @first}}active text-red-600 border-red-600{{/if}}"
                  data-tab="tab-{{@index}}"
                >
                  {{settings.title}}
                </button>
              {{/if}}
            {{/each}}
          </div>

          <!-- Tab Content -->
          <div class="tab-content">
            {{#each section.blocks}}
              {{#if type == "tab"}}
                <div class="tab-pane pt-6 {{#unless @first}}hidden{{/unless}}" id="tab-{{@index}}">
                  {{{settings.content}}}
                </div>
              {{/if}}
            {{/each}}
          </div>
        </div>
      </div>
    {{/if}}
  </div>
</div>

<script>
  // Handle variant changes
  function handleVariantChange(event) {
    const variant = event.detail
    // Update page elements that depend on variant
    const url = new URL(window.location)
    url.searchParams.set('variant', variant.id)
    window.history.replaceState({}, '', url)
  }

  // Tab functionality
  document.addEventListener('DOMContentLoaded', () => {
    const tabHeaders = document.querySelectorAll('.tab-header')
    const tabPanes = document.querySelectorAll('.tab-pane')

    tabHeaders.forEach(header => {
      header.addEventListener('click', () => {
        const tabId = header.dataset.tab
        
        // Update headers
        tabHeaders.forEach(h => {
          h.classList.remove('active', 'text-red-600', 'border-red-600')
          h.classList.add('text-gray-600')
        })
        header.classList.add('active', 'text-red-600', 'border-red-600')
        header.classList.remove('text-gray-600')
        
        // Update panes
        tabPanes.forEach(pane => {
          pane.classList.add('hidden')
        })
        document.getElementById(tabId).classList.remove('hidden')
      })
    })
  })
</script>

<style>
  .tabs {
    @apply w-full;
  }
  
  .tab-header {
    @apply transition-colors duration-200;
  }
  
  .tab-header.active {
    @apply border-red-600 text-red-600;
  }
</style>

{{#schema}}
{
  "name": "Product information",
  "class": "section",
  "settings": [
    {
      "type": "group_header",
      "label": "Gallery Settings"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "label": "Gallery layout",
      "options": [
        {
          "value": "thumbnails_bottom",
          "label": "Thumbnails bottom"
        },
        {
          "value": "thumbnails_left",
          "label": "Thumbnails left"
        }
      ],
      "default": "thumbnails_bottom"
    },
    {
      "type": "switch",
      "id": "enable_zoom",
      "label": "Enable image zoom",
      "default": true
    },
    {
      "type": "switch",
      "id": "enable_lightbox",
      "label": "Enable lightbox",
      "default": true
    },
    {
      "type": "group_header",
      "label": "Product Information"
    },
    {
      "type": "switch",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": true
    },
    {
      "type": "switch",
      "id": "show_sku",
      "label": "Show SKU",
      "default": false
    },
    {
      "type": "switch",
      "id": "show_availability",
      "label": "Show availability",
      "default": true
    },
    {
      "type": "switch",
      "id": "show_buy_now",
      "label": "Show Buy Now button",
      "default": true
    },
    {
      "type": "switch",
      "id": "show_breadcrumb",
      "label": "Show breadcrumb navigation",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "Custom tab",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Tab title",
          "default": "Additional Information"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Tab content",
          "default": "<p>Add custom product information here</p>"
        }
      ]
    },
    {
      "type": "collapsible_row",
      "name": "Collapsible row",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Shipping & Returns"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content",
          "default": "<p>Free shipping on orders over $50</p>"
        },
        {
          "type": "switch",
          "id": "open_by_default",
          "label": "Open by default",
          "default": false
        }
      ]
    }
  ]
}
{{/schema}}