<div class="product-page bg-white">
  <!-- Breadcrumb -->
  <div class="bg-gray-50 border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <nav class="text-sm" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-gray-500">
          <li><a href="/" class="hover:text-red-600 transition-colors">Home</a></li>
          <li><span class="mx-2">/</span></li>
          {{#if product.collections.first}}
            <li><a href="{{product.collections.first.url}}" class="hover:text-red-600 transition-colors">{{product.collections.first.title}}</a></li>
            <li><span class="mx-2">/</span></li>
          {{/if}}
          <li class="text-gray-900 font-medium">{{product.title}}</li>
        </ol>
      </nav>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
      
      <!-- Product Images -->
      <div class="product-images">
        {{#if product.images}}
          <!-- Main Image -->
          <div class="mb-6">
            <div class="aspect-square bg-gray-100 rounded-2xl overflow-hidden shadow-lg">
              <img id="mainImage" 
                   src="{{image_url product.images.[0] width=800}}" 
                   alt="{{product.title}}" 
                   class="w-full h-full object-cover transition-opacity duration-300">
            </div>
          </div>
          
          <!-- Thumbnail Gallery -->
          {{#if product.images.[1]}}
            <div class="flex gap-3 overflow-x-auto pb-2">
              {{#each product.images}}
                <button type="button" 
                        class="thumbnail-btn flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-all duration-200 {{#if @first}}border-red-500 ring-2 ring-red-200{{else}}border-gray-200 hover:border-gray-300{{/if}}"
                        onclick="changeMainImage('{{image_url this width=800}}', this)">
                  <img src="{{image_url this width=120}}" 
                       alt="{{../product.title}}" 
                       class="w-full h-full object-cover">
                </button>
              {{/each}}
            </div>
          {{/if}}
        {{/if}}
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <!-- Vendor -->
        {{#if product.vendor}}
          <p class="text-sm font-medium text-gray-600 uppercase tracking-wide mb-2">{{product.vendor}}</p>
        {{/if}}
        
        <!-- Title -->
        <h1 class="text-4xl font-bold text-gray-900 mb-4 leading-tight">{{product.title}}</h1>
        
        <!-- Price -->
        <div class="mb-6">
          {{#if product.compare_at_price}}
            <div class="flex items-center gap-3">
              <span class="text-3xl font-bold text-red-600">{{money_with_currency product.price}}</span>
              <span class="text-xl text-gray-500 line-through">{{money_with_currency product.compare_at_price}}</span>
              <span class="bg-red-100 text-red-800 text-sm font-medium px-2.5 py-0.5 rounded-full">
                Save {{money_with_currency (minus product.compare_at_price product.price)}}
              </span>
            </div>
          {{else}}
            <span class="text-3xl font-bold text-gray-900">{{money_with_currency product.price}}</span>
          {{/if}}
        </div>
        
        <!-- Description -->
        {{#if product.description}}
          <div class="prose prose-gray max-w-none mb-8">
            <div class="text-gray-700 leading-relaxed">{{{product.description}}}</div>
          </div>
        {{/if}}
        
        <!-- Add to Cart Form -->
        <div class="space-y-6">
          <!-- Quantity Selector -->
          <div class="space-y-2">
            <label for="quantity" class="text-sm font-medium text-gray-900">Quantity</label>
            <div class="flex items-center">
              <div class="inline-flex items-center border border-gray-300 rounded-lg overflow-hidden bg-white">
                <button type="button" 
                        class="quantity-btn w-10 h-12 flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-gray-600 hover:text-gray-800 transition-colors border-r border-gray-300 disabled:opacity-30 disabled:cursor-not-allowed" 
                        onclick="changeQuantity(-1)"
                        id="decreaseBtn">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                  </svg>
                </button>
                <input type="number" 
                       id="quantity"
                       name="quantity"
                       value="1" 
                       min="1" 
                       max="99"
                       class="w-16 h-12 text-center border-0 bg-white text-gray-900 font-medium focus:outline-none focus:ring-2 focus:ring-red-500"
                       onchange="updateQuantity(this.value)">
                <button type="button" 
                        class="quantity-btn w-10 h-12 flex items-center justify-center bg-gray-50 hover:bg-gray-100 text-gray-600 hover:text-gray-800 transition-colors border-l border-gray-300" 
                        onclick="changeQuantity(1)">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Add to Cart Buttons -->
          <div class="space-y-3">
            <button type="button" 
                    id="addToCartBtn"
                    onclick="addToCart()"
                    class="w-full bg-red-600 text-white py-4 px-8 rounded-xl font-semibold text-lg hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-red-500/20 transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
              <span class="add-to-cart-text">Add to Cart</span>
              <span class="add-to-cart-loading hidden">Adding...</span>
            </button>
            <button type="button" 
                    onclick="buyNow()"
                    class="w-full bg-gray-900 text-white py-4 px-8 rounded-xl font-semibold text-lg hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-500/20 transition-all duration-200">
              Buy Now
            </button>
          </div>
        </div>
        
        <!-- Product Features -->
        <div class="mt-8 pt-8 border-t border-gray-200">
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="flex items-center gap-2 text-gray-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              <span>Free shipping</span>
            </div>
            <div class="flex items-center gap-2 text-gray-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span>30-day returns</span>
            </div>
            <div class="flex items-center gap-2 text-gray-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
              <span>Secure payment</span>
            </div>
            <div class="flex items-center gap-2 text-gray-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              <span>Fast delivery</span>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script>
  // Product data
  const productData = {
    variantId: '{{product.first_available_variant.id}}',
    title: '{{product.title}}',
    price: '{{product.price}}',
    image: '{{image_url product.images.[0] width=300}}'
  };

  // Image gallery functionality
  function changeMainImage(src, button) {
    const mainImage = document.getElementById('mainImage');
    const thumbnails = document.querySelectorAll('.thumbnail-btn');
    
    // Update main image
    mainImage.src = src;
    
    // Update thumbnail active state
    thumbnails.forEach(thumb => {
      thumb.classList.remove('border-red-500', 'ring-2', 'ring-red-200');
      thumb.classList.add('border-gray-200');
    });
    
    button.classList.remove('border-gray-200');
    button.classList.add('border-red-500', 'ring-2', 'ring-red-200');
  }
  
  // Quantity selector functionality
  function changeQuantity(change) {
    const quantityInput = document.getElementById('quantity');
    const currentValue = parseInt(quantityInput.value) || 1;
    const newValue = Math.max(1, Math.min(99, currentValue + change));
    
    quantityInput.value = newValue;
    updateQuantityButtons();
  }
  
  function updateQuantity(value) {
    const quantityInput = document.getElementById('quantity');
    const newValue = Math.max(1, Math.min(99, parseInt(value) || 1));
    quantityInput.value = newValue;
    updateQuantityButtons();
  }
  
  function updateQuantityButtons() {
    const quantityInput = document.getElementById('quantity');
    const decreaseBtn = document.getElementById('decreaseBtn');
    const currentValue = parseInt(quantityInput.value);
    
    decreaseBtn.disabled = currentValue <= 1;
  }
  
  // Add to cart functionality
  function addToCart() {
    const quantityInput = document.getElementById('quantity');
    const addToCartBtn = document.getElementById('addToCartBtn');
    const addToCartText = addToCartBtn.querySelector('.add-to-cart-text');
    const addToCartLoading = addToCartBtn.querySelector('.add-to-cart-loading');
    
    const quantity = parseInt(quantityInput.value) || 1;
    
    // Show loading state
    addToCartBtn.disabled = true;
    addToCartText.classList.add('hidden');
    addToCartLoading.classList.remove('hidden');
    
    // Prepare cart data
    const cartData = {
      items: [{
        id: productData.variantId,
        quantity: quantity
      }]
    };
    
    // Add to cart via AJAX
    fetch('/api/carts/ajax-cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(cartData)
    })
    .then(response => response.json())
    .then(data => {
      // Reset button state
      addToCartBtn.disabled = false;
      addToCartText.classList.remove('hidden');
      addToCartLoading.classList.add('hidden');
      
      // Update global cart state if OrionCart exists
      if (window.OrionCart) {
        window.OrionCart.fetchCart().then(() => {
          window.OrionCart.openDrawer();
        });
      } else {
        // Fallback: redirect to cart page
        window.location.href = '/cart';
      }
      
      // Show success feedback using global system
      if (window.OrionNotifications) {
        window.OrionNotifications.cartSuccess(productData.title, quantity)
      };
    })
    .catch(error => {
      console.error('Error adding to cart:', error);
      
      // Reset button state
      addToCartBtn.disabled = false;
      addToCartText.classList.remove('hidden');
      addToCartLoading.classList.add('hidden');
      
      // Show error feedback using global system
      if (window.OrionNotifications) {
        window.OrionNotifications.cartError()
      }
    });
  }
  
  // Buy now functionality
  function buyNow() {
    // First add to cart, then redirect to checkout
    const quantityInput = document.getElementById('quantity');
    const quantity = parseInt(quantityInput.value) || 1;
    
    const cartData = {
      items: [{
        id: productData.variantId,
        quantity: quantity
      }]
    };
    
    fetch('/api/carts/ajax-cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(cartData)
    })
    .then(response => response.json())
    .then(data => {
      // Redirect to checkout
      window.location.href = '/checkout';
    })
    .catch(error => {
      console.error('Error with buy now:', error);
      if (window.OrionNotifications) {
        window.OrionNotifications.error('Failed to proceed to checkout. Please try again.')
      }
    });
  }
  
  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    updateQuantityButtons();
  });
</script>

<style>
  /* Custom quantity input styling */
  input[type=number]::-webkit-outer-spin-button,
  input[type=number]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  
  input[type=number] {
    -moz-appearance: textfield;
    appearance: textfield;
  }
  
  /* Smooth hover effects */
  .quantity-btn:hover {
    transform: scale(1.05);
  }
  
  .thumbnail-btn:hover {
    transform: scale(1.05);
  }
  
  /* Prose styling for product description */
  .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
    color: #111827;
    font-weight: 600;
    margin-top: 1.5em;
    margin-bottom: 0.5em;
  }
  
  .prose p {
    margin-bottom: 1em;
  }
  
  .prose ul, .prose ol {
    margin-bottom: 1em;
    padding-left: 1.25em;
  }
  
  .prose li {
    margin-bottom: 0.25em;
  }
  
  .prose strong {
    font-weight: 600;
    color: #111827;
  }
</style>

{{#schema}}
{
  "name": "Product",
  "class": "section"
}
{{/schema}}